<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#E87722">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <title>Benetrip - Seu Roteiro de Viagem</title>
    <meta name="description" content="Seu roteiro personalizado criado pela Tripinha - Descubra experi√™ncias √∫nicas no seu destino!">
    <meta name="keywords" content="roteiro viagem, planejamento viagem, destinos, turismo, Benetrip">
    <meta name="author" content="Benetrip">
    
    <!-- Open Graph para compartilhamento -->
    <meta property="og:title" content="Benetrip - Seu Roteiro de Viagem">
    <meta property="og:description" content="Roteiro personalizado criado pela Tripinha">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://benetrip.com.br/itinerary.html">
    <meta property="og:image" content="https://benetrip.com.br/assets/images/og-image.jpg">
    
    <!-- Preload fonts para performance -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Montserrat:wght@400;500&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
    </noscript>
    
    <!-- CSS otimizado -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/itinerary.css">
    
    <!-- PWA e favicons com fallbacks -->
    <link rel="apple-touch-icon" href="assets/images/icon-192.png" onerror="this.href='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjRTg3NzIyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI2NCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkI8L3RleHQ+PC9zdmc+'">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/icon-192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icon-32.png">
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    <!-- Preconnect para melhor performance -->
    <link rel="preconnect" href="https://picsum.photos">
    <link rel="preconnect" href="https://source.unsplash.com">
    <link rel="preconnect" href="https://api.pexels.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    
    <!-- Critical CSS inline para melhor performance -->
    <style>
        /* Critical CSS para evitar FOUC */
        .benetrip-container { 
            max-width: 480px; 
            margin: 0 auto; 
            background: #fff; 
            min-height: 100vh; 
            position: relative; 
        }
        .loading-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 70vh; 
            padding: 20px; 
        }
        .loading-content { 
            text-align: center; 
            max-width: 320px; 
        }
        .app-header { 
            display: flex; 
            align-items: center; 
            padding: 15px 20px; 
            background: #fff; 
            border-bottom: 1px solid #E0E0E0; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .btn-voltar { 
            background: none; 
            border: none; 
            padding: 8px; 
            margin-right: 15px; 
            cursor: pointer; 
        }
    </style>
</head>
<body class="mobile-optimized">
    <!-- Container principal otimizado para mobile -->
    <div id="roteiro-container" class="benetrip-container" role="main">
        
        <!-- Header responsivo com skip link -->
        <a href="#main-content" class="skip-link" aria-label="Pular para conte√∫do principal">Pular para o conte√∫do</a>
        
        <header class="app-header" role="banner">
            <button 
                class="btn-voltar" 
                aria-label="Voltar √† p√°gina anterior" 
                type="button"
                title="Voltar"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M19 12H5M12 19l-7-7 7-7"></path>
                </svg>
            </button>
            <h1 id="page-title">Seu Roteiro</h1>
        </header>
        
        <!-- Conte√∫do principal do roteiro -->
        <main class="roteiro-content" role="main" id="main-content" aria-labelledby="page-title">
            
            <!-- Loading inicial com anima√ß√µes otimizadas -->
            <div class="loading-container" id="loading-inicial" aria-live="polite" aria-label="Carregando roteiro">
                <div class="loading-content">
                    <div class="loading-avatar-container">
                        <img 
                            src="assets/images/tripinha/loading2.png" 
                            alt="Tripinha preparando seu roteiro" 
                            class="loading-avatar"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                            loading="eager"
                            width="120"
                            height="120"
                        >
                        <div class="loading-emoji" style="display:none;" role="img" aria-label="Cachorro">üêï</div>
                    </div>
                    
                    <div class="loading-text" id="loading-message" aria-live="polite">
                        Preparando seu roteiro personalizado...
                    </div>
                    
                    <div class="progress-bar-container" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="10">
                        <div 
                            class="progress-bar" 
                            id="progress-bar"
                            style="width: 10%;" 
                            aria-label="Progresso do carregamento"
                        ></div>
                    </div>
                    
                    <p class="loading-subtitle">
                        A Tripinha est√° organizando as melhores experi√™ncias para voc√™! üêæ
                    </p>
                </div>
            </div>
            
            <!-- Conte√∫do ser√° inserido dinamicamente aqui -->
            
        </main>
        
        <!-- Barra de a√ß√µes fixa otimizada -->
        <div class="botao-acoes-fixo" role="toolbar" aria-label="A√ß√µes do roteiro">
            <button 
                class="btn-secundario" 
                id="btn-editar-roteiro" 
                type="button"
                aria-label="Personalizar seu roteiro de viagem"
                title="Personalizar roteiro"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                </svg>
                <span>Personalizar</span>
            </button>
            
            <button 
                class="btn-principal" 
                id="btn-compartilhar-roteiro" 
                type="button"
                aria-label="Compartilhar seu roteiro de viagem"
                title="Compartilhar roteiro"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"></path>
                </svg>
                <span>Compartilhar</span>
            </button>
        </div>
    </div>

    <!-- Container para toast notifications -->
    <div id="toast-container" class="toast-container" role="region" aria-live="polite" aria-label="Notifica√ß√µes"></div>

    <!-- Container para modais (futuro) -->
    <div id="modal-container" class="modal-container" role="dialog" aria-hidden="true" aria-modal="true"></div>

    <!-- Scripts otimizados -->
    <script>
        // ‚úÖ CONFIGURA√á√ÉO ATUALIZADA para compatibilidade com JS corrigido
        window.BENETRIP_CONFIG = {
            apiBaseUrl: '/api',
            imageQuality: 'medium', // low, medium, high
            enableLazyLoading: true,
            enableImageOptimization: true,
            debugMode: false, // true em desenvolvimento
            maxRetryAttempts: 3,
            requestTimeout: 8000,
            // ‚úÖ Removido maxImagesPerDay j√° que agora busca TODAS as imagens
            fallbackImageEnabled: true
        };
        
        // Detectar dispositivo mobile (melhorado)
        window.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        window.isTablet = /iPad|Android(?!.*Mobile)/i.test(navigator.userAgent);
        window.isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // ‚úÖ Service Worker com verifica√ß√£o de exist√™ncia
        if ('serviceWorker' in navigator && location.hostname !== 'localhost') {
            fetch('/sw.js', { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        navigator.serviceWorker.register('/sw.js')
                            .then(reg => console.log('SW registrado:', reg.scope))
                            .catch(err => console.log('SW falhou:', err));
                    }
                })
                .catch(() => console.log('SW n√£o dispon√≠vel'));
        }
        
        // ‚úÖ Preloader com verifica√ß√£o de exist√™ncia dos recursos
        function preloadCriticalResources() {
            const criticalImages = [
                'assets/images/tripinha-avatar.png',
                'assets/images/tripinha/loading2.png'
            ];
            
            criticalImages.forEach(src => {
                fetch(src, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            const img = new Image();
                            img.src = src;
                        }
                    })
                    .catch(() => console.log(`Recurso n√£o encontrado: ${src}`));
            });
        }
        
        // Executar preload quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', preloadCriticalResources);
        } else {
            preloadCriticalResources();
        }
        
        // ‚úÖ Otimiza√ß√£o de performance melhorada
        window.addEventListener('load', () => {
            // Remover loading screens desnecess√°rios
            setTimeout(() => {
                const unnecessaryLoaders = document.querySelectorAll('.initial-loader, .page-loader');
                unnecessaryLoaders.forEach(loader => {
                    if (loader && loader !== document.getElementById('loading-inicial')) {
                        loader.remove();
                    }
                });
            }, 100);
            
            // Marcar como carregado
            document.body.classList.add('loaded');
        });
        
        // ‚úÖ Preven√ß√£o de zoom acidental melhorada
        let lastTouchEnd = 0;
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        });
        
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // ‚úÖ Smooth scroll melhorado
        document.addEventListener('click', function(e) {
            const anchor = e.target.closest('a[href^="#"]');
            if (anchor && anchor.getAttribute('href') !== '#') {
                e.preventDefault();
                const target = document.querySelector(anchor.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start',
                        inline: 'nearest'
                    });
                    
                    // Foco para acessibilidade
                    if (target.tabIndex < 0) {
                        target.tabIndex = -1;
                    }
                    target.focus();
                }
            }
        });
        
        // ‚úÖ Gerenciamento de erro global
        window.addEventListener('error', function(e) {
            if (window.BENETRIP_CONFIG.debugMode) {
                console.error('Erro global capturado:', e.error);
            }
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            if (window.BENETRIP_CONFIG.debugMode) {
                console.error('Promise rejeitada:', e.reason);
            }
        });
        
        // ‚úÖ Feedback t√°til para dispositivos m√≥veis
        if (window.isTouchDevice) {
            document.addEventListener('touchstart', function(e) {
                const button = e.target.closest('button, .btn, [role="button"]');
                if (button && navigator.vibrate) {
                    navigator.vibrate(10); // Vibra√ß√£o sutil
                }
            });
        }
    </script>
    
    <!-- Scripts principais com fallbacks -->
    <script src="assets/js/api.js" defer onerror="console.warn('api.js n√£o carregou')"></script>
    <script src="assets/js/modal-handler.js" defer onerror="console.warn('modal-handler.js n√£o carregou')"></script>
    <script src="assets/js/itinerary.js" defer onerror="console.error('itinerary.js CR√çTICO n√£o carregou')"></script>
    
    <!-- ‚úÖ Analytics otimizado -->
    <script>
        // Tracking de eventos melhorado
        function trackEvent(eventName, eventData = {}) {
            // Google Analytics 4
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    event_category: 'itinerary',
                    event_label: eventData.label || '',
                    value: eventData.value || 0,
                    ...eventData
                });
            }
            
            // Console para debug
            if (window.BENETRIP_CONFIG?.debugMode) {
                console.log('üìä Event tracked:', eventName, eventData);
            }
            
            // Opcional: enviar para API pr√≥pria
            if (eventData.critical) {
                fetch('/api/analytics', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ event: eventName, data: eventData, timestamp: Date.now() })
                }).catch(() => {}); // Silenciosamente falhar
            }
        }
        
        // Eventos autom√°ticos melhorados
        window.addEventListener('load', () => {
            trackEvent('page_load', { 
                page: 'itinerary',
                loadTime: performance.now(),
                userAgent: navigator.userAgent,
                isMobile: window.isMobile
            });
        });
        
        // Track sa√≠da da p√°gina
        window.addEventListener('beforeunload', () => {
            trackEvent('page_unload', { 
                page: 'itinerary',
                timeSpent: performance.now()
            });
        });
        
        // Track erros JavaScript
        window.addEventListener('error', (e) => {
            trackEvent('js_error', {
                critical: true,
                message: e.message,
                filename: e.filename,
                lineno: e.lineno
            });
        });
        
        // Disponibilizar globalmente
        window.trackEvent = trackEvent;
    </script>
    
    <!-- ‚úÖ Schema.org melhorado para SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Benetrip Travel Planner",
        "description": "Planejador de viagens inteligente que cria roteiros personalizados com a ajuda da Tripinha",
        "url": "https://benetrip.com.br",
        "applicationCategory": "TravelApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "BRL"
        },
        "provider": {
            "@type": "Organization",
            "name": "Benetrip",
            "url": "https://benetrip.com.br",
            "logo": "https://benetrip.com.br/assets/images/logo.png"
        },
        "creator": {
            "@type": "Organization",
            "name": "Benetrip"
        },
        "featureList": [
            "Roteiros personalizados",
            "Busca de voos",
            "Recomenda√ß√µes de destinos",
            "Planejamento inteligente"
        ]
    }
    </script>
    
    <!-- ‚úÖ PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- ‚úÖ Preload de recursos cr√≠ticos do CSS -->
    <script>
        // Carregar CSS n√£o cr√≠tico de forma ass√≠ncrona
        function loadCSS(href) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href;
            link.media = 'print';
            link.onload = function() { this.media = 'all'; };
            document.head.appendChild(link);
        }
        
        // Carregar fontes de √≠cones se necess√°rio
        // loadCSS('assets/css/icons.css');
    </script>
</body>
</html>
